# JWT 토큰 기반 인증

## 토큰 기반 인증
- 유저의 로그인 인증 정보를 세션에 담지 않는 인증 방식으로 저장소가 필요 없음 
(stateless - 상태 정보를 유지하지 않음)
- 아이디, 패스워드를 확인하여 유저가 맞으면 토큰을 제공
- 클라이언트는 제공받은 토큰을 저장해두고 서버에 요청할 때마다 토큰을 request header에 담아 서버에 전달

#### 토큰의 장점
 - stateless하기 때문에 서버를 확장하기에 용이
 - 토큰을 사용함으로써 다른 서비스에서도 권한 공유 가능
 (google, github, facebook등 다양한 계정으로 로그인 가능)

#### 토큰의 단점
- 이미 발급된 토큰에 대해서 유효기간이 완료될 때까지 계속 사용이 가능하기 때문에 탈취될 시 정보유출의 위험
- 단점을 보완하기 위해 만료주기가 짧은 access token 발급
- 만료된 access token를 재발급할 때 refresh token 사용

#### OAuth
- 외부서비스에 인증하고 권한부여를 관리하는 프레임 워크
- 플랫폼간의 권한 공유 가능

## JWT (Json Web Token)
- Json 포맷을 이용하여 사용자에 대한 속성을 저장하는 Claim 기반의 Web Token
- 전자서명이 포함된 토큰
- JWT 구성
    - header : 토큰 타입. 암호화 방법 지정
    - payload : 토큰에 담을 정보 저장 (name: value 형태)
    - signature : 서명정보(secret key, header, payload 정보가 암호화)

## 클라이언트 저장소
### 쿠키 (Cookie)
- **서버에 데이터가 저장**된 후 저장된 session에 접근하기 위한 session ID
- 클라이언트가 서버에 방문한 정보를 클라이언트 단에 저장
- 만료 기한이 있는 key-value 저장소
- 4KB의 용량제한
- 클라이언트의 정보를 담아 서버로 보내면 서버는 쿠키를 읽어서 누구인지 파악
(서버와 클라이언트 간의 지속적인 데이터 교환)
- 유효시간이 정해지면 브라우저가 종료되어도 인증 유지
- 로그인 아이디 자동완성, 오늘 하루 창 열지 않기, 비로그인 상태로 장바구니 사용 등
- 사용자의 편의를 위하되, 지워지거나 가로채지더라도 큰 상관 없는 정보들을 브라우저에 저장

#### 세션 쿠키 (Session Cookies)
- 만료일이 포함되어 있지 않음
- 브랑저나 탭이 열려있는 동안에만 저장되며, 브라우저가 닫히면 영구적으로 삭제됨

#### 지속 쿠키 (Persistent Cookies)
- 만료일 포함
- 유저의 디스크에 저장되고, 브라우저를 닫거나 컴퓨터를 재시작해도 남아 있으며 만료일이 지나면 삭제됨

```
// 생성하기
document.cookie = 'MY_COOKIE=here';

// 가져오기
console.log(document.cookie)

// 삭제하기 (만료일을 이전으로 돌려서 삭제)
document.cookie = 'MY_COOKIE=here; expires=new Date('2021-01-01).toUTCString()';
```

### 웹 스토리지

- 데이터를 **서버로 전송하지 않고** 클라이언트에 저장
- 서버에 전송되지 않으므로 서버에 부담이 가지 않음
- 로컬 스토리지 / 세션 스토리지 => **영구성** 차이
- 쿠키와 달리 모든 브라우저에 적용되는 것은 아니기 때문에 제한적인 부분이 있음

#### 로컬 스토리지 (Local Storage)
- 클라이언트에 대한 정보를 의도적으로 삭제하지 않는 한 영구적으로 보관
- 만료기간 없이 저장이 가능하여 자동로그인에 사용
- 쿠키보다 더 많은 정보 저장 가능
- 도메인별로 생성되며 다른 도메인의 로컬 스토리지에는 접근 불가능
- 별도로 지워주지 않으면 정보가 남아있기 때문에 보안적인 이슈 발생

```
// 추가하기
localStorage.setItem('MY_LOCAL', 'here');

// 가져오기
localStorage.getItem('MY_LOCAL');

// 삭제하기 (하나만, 전부)
localStorage.removeItem('MY_LOCAL');
localStorage.clear();
```

#### 세션 스토리지 (Session Storage)
- 모든 유저의 인증상태(session)을 유지 
(stateful - 상태정보 유지)
- 서버에 세션을 저장하여 유저가 많아지만 서버의 부담이 늘고 확장성에 불리
- 세션 종료시 (브라우저 종료 시) 클라이언트 정보 삭제
- 서비스 제공자가 직접 관리하여 노출되어서는 안되는 정보 저장
- 동일한 탭/윈도우라도 다른 도메인이라면 또 다른 세션 스토리지 생성
- 서로 다른 세션 스토리지는 서로 영향을 주지 않으며 독립적으로 동작

```
// 추가하기
sessionStorage.setItem('MY_SESSION', 'here');

// 가져오기
sessionStorage.getItem('MY_SESSION');

// 삭제하기 (하나만, 전부)
sessionStorage.removeItem('MY_SESSION');
sessionStorage.clear();
```