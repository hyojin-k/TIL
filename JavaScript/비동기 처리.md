# 비동기 처리

## 비동기(asychronous) 작업

- 동기적(synchronous) 처리 방식은 하나의 작업이 끝날때까지 기다리는 동안 중지 상태가 되어 다른 작업을 동시에 할 수 없는 반면, 비동기적 작업은 **동시에 여러가지 작업 처리 가능**
- Ajax, setTimeout, setInterval, HTTP 요쳥, 이벤트 핸들러


## 자바스크립트가 동작하는 방식

- **싱글 스레드(single thread)** 방식 : 자바스크립트는 하나의 실행 컨텍스트 스택(콜 스택)을 가지고 있고, 이는 2개 이상의 함수를 동시에 실행할 수 없음을 뜻함 (**한 번에 코드 하나만 실행**할 수 있음)
- 콜백 패턴을 사용 => **콜백 지옥(콜백 헬)** 발생 

### 콜백 함수
- 다른 함수에 인자로 전달되어진 함수
- 어떤 일이 완료되고 나서 실행되는 함수

### 콜백 지옥 (callback hell)
- 콜백 안에서 계속 콜백을 요청하는 것으로, 비동기가 중첩이 되면서 코드가 깊어지고 디버깅하기 어려워지는 현상
- 가독성이 떨어지고 유지보수가 어려움
- 해결하기 위해 Promise나 async/await 사용

## 자바스크립트 엔진
- 사용자가 작성한 JS 파일을 컴퓨터가 실행할 수 있도록 기계어로 번역하는 역할
- 메모리힙(저장장소)과 콜 스택으로 구성

### 메모리 힙 (memory heap)
- **객체가 저장되는 메모리 공간**으로, 콜 스택의 요소인 실행 컨텍스트는 힙에 저장된 객체를 참조
- 선언한 변수들이 어디에 저장되어 있는지 기록하는 장치

### 콜 스택 (call stack)
- 실행 컨텍스트가 추가되고 제거되는 스택 자료구조인 실행 컨텍스트 스택
- 함수를 호출하면 함수 실행 컨텍스트가 순차적으로 콜 스택에 푸쉬되어 순차적으로 실행되고 실행이 끝나면 콜 스택에서 빠져나감

![asychronous](https://user-images.githubusercontent.com/50295043/149153515-2df47be4-af56-4dad-b5a0-0481dcc46098.png)


### Web API
- 브라우저가 제공하는 API
- 함수들이 비동기적으로 실행
- 실행된 결과물이 콜백 큐에 쌓임

### 콜백 큐 (callback queue) / 테스크 큐 (task queue)
- 비동기 함수의 콜백함수 또는 이벤트 핸들러가 일시적으로 보관되는 장소
- 콜백 함수들이 큐 방식으로 쌓여있는 공간
- 콜 스택이 비어질 때까지(전역 코드 및 호출된 함수가 모두 종료할 때까지) 비동기 함수 보관

### 이벤트 루프 
- 자바스크립트의 동시성을 지원
- 콜 스택에 현재 실행 중인 실행 컨텍스트가 있는지, 콜백 큐에 대기중인 함수가 있는지 반복해서 확인
- 콜 스택이 비어있으면 콜백 큐에 대기하고 있는 함수를 순차적으로(FIFO) 콜 스택에 이동시킴


**참고**

모던 자바스크립트 Deep Dive